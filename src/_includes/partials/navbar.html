{% macro nav(bgColour) %}

  <!-- Top Strapline Bar -->
  <div class="bg-bg-secondary border-b border-border-dark">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2 flex justify-between items-center">
      <p class="text-sm mb-0 text-text-secondary">{{ settings.strapLine }}</p>
      <div class="flex items-center gap-3">
        <span class="text-xs text-neon-green font-semibold">18+</span>
        <img src="/_includes/static/img/gb.svg" width="24px" height="18px" class="inline-block opacity-80" alt="United Kingdom flag">
      </div>
    </div>
  </div>

  <!-- Main Navigation -->
  <div class="bg-bg-primary/95 backdrop-blur-md sticky top-0 z-50 border-b border-border-dark">
    <header class="flex min-h-[70px] tracking-wide max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="w-full flex flex-wrap items-center gap-6 py-4 relative">

        <!-- Logo -->
        <a href="/" class="group relative">
          <img src="/_includes/static/img/logo-big.avif" alt="Slot Picks logo" class="w-[110px] transition-all duration-300 group-hover:brightness-110" width="110px" height="110px">
          <div class="absolute -inset-2 bg-neon-green/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 -z-10"></div>
        </a>

        <!-- Desktop Navigation -->
        <nav class="lg:ml-auto hidden lg:block">
          <ul class="flex lg:gap-x-8">
            {% if navigation.firstLevelItems %}
              {% for item in navigation.firstLevelItems %}
                {% if item.secondLevelItems %}
                  <!-- Dropdown Menu Item -->
                  <li class="group text-[14px] relative">
                    <span class="flex items-center gap-1 text-text-secondary hover:text-neon-green font-medium text-[15px] cursor-pointer transition-colors duration-200">
                      {{ item.text }}
                      <svg xmlns="http://www.w3.org/2000/svg" width="14px" height="14px" class="fill-current transition-transform duration-200 group-hover:rotate-180" viewBox="0 0 24 24">
                        <path d="M12 16a1 1 0 0 1-.71-.29l-6-6a1 1 0 0 1 1.42-1.42l5.29 5.3 5.29-5.29a1 1 0 0 1 1.41 1.41l-6 6a1 1 0 0 1-.7.29z" data-name="16" data-original="#000000"></path>
                      </svg>
                    </span>

                    <!-- Dropdown Content -->
                    <div class="absolute top-8 -left-4 z-50 min-w-[200px] opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
                      <div class="bg-bg-card border border-border-dark rounded-xl shadow-2xl overflow-hidden mt-2">
                        <!-- Neon accent line -->
                        <div class="h-0.5 bg-gradient-neon"></div>

                        <ul class="py-2">
                          {% for subItem in item.secondLevelItems %}
                            <li>
                              <a href="{{ subItem.url }}" class="block px-5 py-3 text-text-secondary hover:text-neon-green hover:bg-bg-secondary/50 text-[14px] transition-all duration-200 border-l-2 border-transparent hover:border-neon-green">
                                {{ subItem.text }}
                              </a>
                            </li>
                          {% endfor %}
                        </ul>
                      </div>
                    </div>
                  </li>
                {% else %}
                  <!-- Regular Menu Item -->
                  <li>
                    <a href="{{ item.url }}" class="nav-link text-text-secondary hover:text-neon-green font-medium text-[15px] block transition-colors duration-200">
                      {{ item.text }}
                    </a>
                  </li>
                {% endif %}
              {% endfor %}
            {% endif %}
          </ul>
        </nav>

        <!-- Mobile Menu Toggle -->
        <div class="flex items-center ml-auto lg:hidden">
          <button data-test="toggleOpen" class="p-2 rounded-lg border border-border-dark hover:border-neon-green hover:bg-bg-card transition-all duration-200" aria-label="Open Menu">
            <svg class="w-6 h-6 fill-text-secondary" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>
      </div>
    </header>
  </div>

  <!-- Mobile Menu (outside of backdrop-blur container) -->
  <div data-test="menu" class="lg:hidden hidden fixed inset-0 z-[100]">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/60" data-test="menuBackdrop"></div>

    <!-- Mobile Close Button -->
    <button data-test="toggleClose" class="fixed top-4 right-4 z-[110] rounded-full bg-bg-card w-10 h-10 flex items-center justify-center border border-neon-green/30 hover:border-neon-green hover:shadow-neon-green transition-all duration-300">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 fill-neon-green" viewBox="0 0 320.591 320.591">
        <path d="M30.391 318.583a30.37 30.37 0 0 1-21.56-7.288c-11.774-11.844-11.774-30.973 0-42.817L266.643 10.665c12.246-11.459 31.462-10.822 42.921 1.424 10.362 11.074 10.966 28.095 1.414 39.875L51.647 311.295a30.366 30.366 0 0 1-21.256 7.288z" data-original="#000000"></path>
        <path d="M287.9 318.583a30.37 30.37 0 0 1-21.257-8.806L8.83 51.963C-2.078 39.225-.595 20.055 12.143 9.146c11.369-9.736 28.136-9.736 39.504 0l259.331 257.813c12.243 11.462 12.876 30.679 1.414 42.922-.456.487-.927.958-1.414 1.414a30.368 30.368 0 0 1-23.078 7.288z" data-original="#000000"></path>
      </svg>
    </button>

    <!-- Menu Panel -->
    <nav class="fixed top-0 left-0 w-[280px] h-full bg-bg-primary border-r border-border-dark shadow-2xl overflow-auto z-[105]">
      <div class="p-6">
        <!-- Mobile Logo -->
        <div class="border-b border-border-dark pb-4 mb-4">
          <a href="/">
            <img src="/_includes/static/img/logo-big.avif" alt="Slot Picks logo" class="w-[100px]" width="100px" height="100px">
          </a>
        </div>

        <ul class="space-y-1">
          {% if navigation.firstLevelItems %}
            {% for item in navigation.firstLevelItems %}
              {% if item.secondLevelItems %}
                <!-- Parent Item with Children -->
                <li class="py-2">
                  <span class="text-text-secondary font-medium text-[15px] block mb-2">{{ item.text }}</span>
                  <ul class="pl-4 space-y-1 border-l border-border-dark">
                    {% for subItem in item.secondLevelItems %}
                      <li>
                        <a href="{{ subItem.url }}" class="block py-2 text-text-secondary hover:text-neon-green text-[14px] transition-colors duration-200">
                          {{ subItem.text }}
                        </a>
                      </li>
                    {% endfor %}
                  </ul>
                </li>
              {% else %}
                <!-- Regular Menu Item -->
                <li class="py-2">
                  <a href="{{ item.url }}" class="text-text-secondary hover:text-neon-green font-medium text-[15px] block transition-colors duration-200">
                    {{ item.text }}
                  </a>
                </li>
              {% endif %}
            {% endfor %}
          {% endif %}
        </ul>

        <!-- Mobile CTA -->
        <div class="mt-6 pt-4 border-t border-border-dark">
          <a href="/slots/" class="btn btn-primary w-full text-center">
            View All Slots
          </a>
        </div>
      </div>
    </nav>
  </div>

{% endmacro %}
